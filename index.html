<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perpustakaan Digital SMAN 1 Magetan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #3b82f6;
            --accent: #f59e0b;
        }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #020617;
            color: #f8fafc;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }
        
        /* Latar Belakang Ultra Modern */
        .bg-animated {
            background: radial-gradient(circle at 20% 20%, #1e3a8a 0%, transparent 40%),
                        radial-gradient(circle at 80% 80%, #1e40af 0%, transparent 40%),
                        radial-gradient(circle at 50% 50%, #020617 0%, #000 100%);
            position: fixed;
            inset: 0;
            z-index: -1;
        }

        .mesh-gradient {
            position: fixed;
            inset: 0;
            opacity: 0.5;
            background-image: 
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.5) 0, transparent 50%), 
                radial-gradient(at 50% 0%, rgba(99, 102, 241, 0.5) 0, transparent 50%), 
                radial-gradient(at 100% 0%, rgba(147, 51, 234, 0.5) 0, transparent 50%);
            filter: blur(100px);
            z-index: -1;
        }

        .grid-pattern {
            position: fixed;
            inset: 0;
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.2;
            z-index: -1;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 40px 100px -20px rgba(0, 0, 0, 0.6);
        }

        /* Enhanced Option Card */
        .option-card {
            background: rgba(255, 255, 255, 1);
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            overflow: hidden;
            color: #1e293b;
            border: 1px solid rgba(255, 255, 255, 1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .option-card:hover {
            transform: translateY(-20px) scale(1.02);
            box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.5);
            background: rgba(255, 255, 255, 1);
        }

        .option-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(59, 130, 246, 0.03) 100%);
            opacity: 0;
            transition: opacity 0.6s;
        }

        .option-card:hover::after {
            opacity: 1;
        }

        .card-number {
            position: absolute;
            top: 20px;
            right: 40px;
            font-size: 8rem;
            font-weight: 900;
            line-height: 1;
            color: rgba(0, 0, 0, 0.03);
            pointer-events: none;
            transition: all 0.6s;
        }

        .option-card:hover .card-number {
            color: rgba(0, 0, 0, 0.06);
            transform: translateY(10px);
        }

        .floating-icon {
            animation: float 5s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-20px) rotate(3deg); }
        }

        .page-transition {
            animation: scaleUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        @keyframes scaleUp {
            from { opacity: 0; transform: scale(0.95) translateY(30px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .book-icon-bg {
            position: absolute;
            right: -40px;
            bottom: -40px;
            font-size: 15rem;
            opacity: 0.03;
            transform: rotate(-15deg);
            transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
        }
        .option-card:hover .book-icon-bg {
            opacity: 0.08;
            transform: rotate(5deg) scale(1.2);
            right: 0px;
            bottom: 0px;
        }

        /* Input Styling */
        input::placeholder {
            color: #cbd5e1;
            font-weight: 400;
        }
        .input-focus-effect:focus-within {
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* Custom Decoration */
        .glow-line {
            height: 2px;
            width: 0%;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            transition: width 0.6s ease;
            margin-top: 10px;
        }
        .option-card:hover .glow-line {
            width: 100%;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-8">

    <div class="bg-animated"></div>
    <div class="mesh-gradient"></div>
    <div class="grid-pattern"></div>

    <!-- Halaman Utama (Landing Page) -->
    <div id="landingPage" class="w-full max-w-6xl text-center page-transition">
        <div class="mb-20 relative">
            <div class="relative inline-block mb-10">
                <div class="absolute inset-0 bg-blue-500 blur-[80px] opacity-40 animate-pulse"></div>
                <div class="bg-white p-6 rounded-[2.8rem] shadow-[0_0_60px_rgba(255,255,255,0.2)] relative z-10 floating-icon border border-blue-100">
                    <img src="https://smasa-magetan.sch.id/wp-content/uploads/2023/06/LOGO-SMA-NEGERI-1-MAGETAN-258x300.png" alt="SMASA" class="h-24 sm:h-32 w-auto">
                </div>
            </div>
            
            <h1 class="text-6xl sm:text-8xl font-extrabold tracking-tighter mb-6 leading-tight">
                SMASA <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-indigo-400 to-purple-400">Smart Library</span>
            </h1>
            <p class="text-slate-400 text-lg sm:text-2xl max-w-3xl mx-auto leading-relaxed font-light opacity-80">
                Sistem Layanan Mandiri Perpustakaan SMAN 1 Magetan.<br class="hidden sm:block"> 
                Pilih aksi di bawah untuk melanjutkan perjalanan literasi Anda.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10 sm:gap-14 mt-12 px-4">
            <!-- Pilihan Pinjam -->
            <button onclick="openForm('borrow')" class="option-card p-12 sm:p-16 rounded-[4rem] text-left group">
                <span class="card-number">01</span>
                <div class="book-icon-bg text-blue-600">
                    <i class="fa-solid fa-book-open-reader"></i>
                </div>
                
                <div>
                    <div class="w-24 h-24 bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 text-white rounded-[2.2rem] flex items-center justify-center mb-10 shadow-2xl shadow-blue-500/40 group-hover:scale-110 transition-all duration-500 relative overflow-hidden">
                        <i class="fa-solid fa-plus-circle text-4xl relative z-10"></i>
                        <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    </div>
                    
                    <h2 class="text-4xl sm:text-5xl font-black mb-6 tracking-tighter text-slate-900">PINJAM BUKU</h2>
                    <p class="text-slate-500 text-lg sm:text-xl leading-relaxed mb-12 max-w-[85%]">Ambil koleksi terbaik kami untuk menemanimu belajar dan berimajinasi.</p>
                </div>
                
                <div class="relative w-fit">
                    <div class="flex items-center text-blue-600 font-extrabold text-sm uppercase tracking-[0.3em]">
                        PROSES SEKARANG <i class="fa-solid fa-arrow-right-long ml-6 group-hover:translate-x-6 transition-transform duration-500"></i>
                    </div>
                    <div class="glow-line"></div>
                </div>
            </button>

            <!-- Pilihan Kembali -->
            <button onclick="openForm('return')" class="option-card p-12 sm:p-16 rounded-[4rem] text-left group">
                <span class="card-number">02</span>
                <div class="book-icon-bg text-emerald-600">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                </div>

                <div>
                    <div class="w-24 h-24 bg-gradient-to-br from-emerald-500 via-teal-600 to-cyan-700 text-white rounded-[2.2rem] flex items-center justify-center mb-10 shadow-2xl shadow-emerald-500/40 group-hover:scale-110 transition-all duration-500 relative overflow-hidden">
                        <i class="fa-solid fa-check-circle text-4xl relative z-10"></i>
                        <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    </div>
                    
                    <h2 class="text-4xl sm:text-5xl font-black mb-6 tracking-tighter text-slate-900">KEMBALIKAN</h2>
                    <p class="text-slate-500 text-lg sm:text-xl leading-relaxed mb-12 max-w-[85%]">Kembalikan buku tepat waktu untuk menghindari denda dan membantu teman lain.</p>
                </div>
                
                <div class="relative w-fit">
                    <div class="flex items-center text-emerald-600 font-extrabold text-sm uppercase tracking-[0.3em]">
                        PROSES SEKARANG <i class="fa-solid fa-arrow-right-long ml-6 group-hover:translate-x-6 transition-transform duration-500"></i>
                    </div>
                    <div class="glow-line" style="background: linear-gradient(90deg, transparent, #10b981, transparent);"></div>
                </div>
            </button>
        </div>
        
        <div class="mt-24">
            <div class="inline-flex items-center gap-4 px-10 py-4 rounded-full bg-white/5 border border-white/10 backdrop-blur-2xl shadow-2xl">
                <span class="w-2.5 h-2.5 bg-green-500 rounded-full animate-ping"></span>
                <p id="dateDisplay" class="text-blue-300 font-black text-[11px] uppercase tracking-[0.5em]"></p>
            </div>
        </div>
    </div>

    <!-- Halaman Formulir -->
    <div id="formPage" class="hidden w-full max-w-2xl page-transition">
        <div class="glass-card rounded-[4rem] overflow-hidden relative border border-white/20">
            
            <div class="absolute -top-20 -right-20 w-80 h-80 bg-blue-500/20 blur-[100px] rounded-full"></div>
            <div class="absolute -bottom-20 -left-20 w-80 h-80 bg-purple-500/20 blur-[100px] rounded-full"></div>

            <div id="formHeader" class="p-10 text-white flex items-center justify-between relative overflow-hidden">
                <div class="absolute inset-0 opacity-10">
                    <svg width="100%" height="100%"><pattern id="grid-mini" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="white" stroke-width="0.5"/></pattern><rect width="100%" height="100%" fill="url(#grid-mini)" /></svg>
                </div>
                <button onclick="backToLanding()" class="h-14 w-14 flex items-center justify-center rounded-[1.8rem] bg-white/10 hover:bg-white/20 backdrop-blur-md transition-all active:scale-90 relative z-10 border border-white/20">
                    <i class="fa-solid fa-arrow-left text-xl"></i>
                </button>
                <div class="text-center relative z-10">
                    <h2 id="formTitle" class="font-black text-2xl uppercase tracking-[0.2em]">FORMULIR</h2>
                </div>
                <div class="w-14"></div>
            </div>

            <div class="p-10 sm:p-14 bg-white/95 relative z-10">
                <form id="libraryForm" class="space-y-10" onsubmit="handleFormSubmit(event)">
                    <input type="hidden" id="entryType">

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-3">
                            <label class="block text-[11px] font-black text-slate-400 ml-1 uppercase tracking-[0.2em]">Nama Siswa</label>
                            <div class="relative group input-focus-effect rounded-[1.8rem]">
                                <i class="fa-solid fa-user absolute left-7 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors"></i>
                                <input type="text" id="studentName" required class="w-full pl-16 pr-8 py-5 rounded-[1.8rem] bg-slate-50 border-2 border-slate-100 focus:border-blue-500 focus:bg-white transition-all outline-none text-slate-800 font-bold text-base" placeholder="Nama sesuai absen">
                            </div>
                        </div>
                        <div class="space-y-3">
                            <label class="block text-[11px] font-black text-slate-400 ml-1 uppercase tracking-[0.2em]">Kelas</label>
                            <div class="relative group input-focus-effect rounded-[1.8rem]">
                                <i class="fa-solid fa-school absolute left-7 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors"></i>
                                <input type="text" id="studentClass" required class="w-full pl-16 pr-8 py-5 rounded-[1.8rem] bg-slate-50 border-2 border-slate-100 focus:border-blue-500 focus:bg-white transition-all outline-none text-slate-800 font-bold text-base" placeholder="Contoh: XII.8">
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <label class="block text-[11px] font-black text-slate-400 ml-1 uppercase tracking-[0.2em]">Judul Koleksi / Kode Buku</label>
                        <div class="relative group input-focus-effect rounded-[1.8rem]">
                            <i class="fa-solid fa-book-bookmark absolute left-7 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors"></i>
                            <input type="text" id="bookTitle" required class="w-full pl-16 pr-8 py-5 rounded-[1.8rem] bg-slate-50 border-2 border-slate-100 focus:border-blue-500 focus:bg-white transition-all outline-none text-slate-800 font-bold text-base" placeholder="Masukkan judul buku yang diproses">
                        </div>
                    </div>

                    <button type="submit" id="submitBtn" class="w-full text-white font-black py-6 rounded-[2.2rem] shadow-[0_25px_50px_-12px_rgba(0,0,0,0.2)] transition-all active:scale-95 flex items-center justify-center gap-4 mt-8 text-xl tracking-widest">
                        <span>KONFIRMASI SEKARANG</span>
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </form>

                <div class="mt-12 pt-10 border-t border-slate-100 flex items-center justify-between text-slate-400">
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-shield-check text-blue-500/60 text-xl"></i>
                        <span class="text-[10px] font-black uppercase tracking-[0.2em]">Cloud Security Protocols Active</span>
                    </div>
                    <img src="https://smasa-magetan.sch.id/wp-content/uploads/2023/06/LOGO-SMA-NEGERI-1-MAGETAN-258x300.png" alt="SMASA" class="h-8 opacity-20 grayscale">
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Loading -->
    <div id="loading" class="fixed inset-0 bg-slate-950/95 backdrop-blur-3xl z-[100] flex items-center justify-center hidden">
        <div class="text-center">
            <div class="relative w-40 h-40 mx-auto mb-10">
                <div class="absolute inset-0 border-[10px] border-blue-500/10 rounded-full"></div>
                <div class="absolute inset-0 border-[10px] border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            </div>
            <h2 class="font-black text-white tracking-[0.6em] text-sm uppercase animate-pulse">Menghubungkan ke Server...</h2>
        </div>
    </div>

    <!-- Modal Sukses -->
    <div id="successModal" class="fixed inset-0 z-[110] flex items-center justify-center hidden bg-slate-950/95 backdrop-blur-3xl p-6">
        <div class="bg-white rounded-[4.5rem] p-16 max-w-lg w-full text-center shadow-[0_0_150px_rgba(255,255,255,0.1)] relative overflow-hidden border border-white/20">
            <div id="modalAccent" class="absolute top-0 left-0 w-full h-5"></div>
            
            <div id="successIcon" class="w-32 h-32 rounded-[3.2rem] flex items-center justify-center mx-auto mb-10 text-7xl shadow-2xl">
                <i class="fa-solid fa-check"></i>
            </div>
            
            <h3 class="text-4xl font-black text-slate-900 mb-6 tracking-tighter uppercase">Transaksi Berhasil!</h3>
            <div id="modalMsg" class="text-slate-500 text-lg sm:text-xl mb-14 leading-relaxed font-medium"></div>
            
            <button onclick="closeModal()" class="w-full bg-slate-900 text-white font-black py-7 rounded-[2.2rem] shadow-2xl transition-all active:scale-95 text-lg tracking-widest uppercase">
                TUTUP & KEMBALI
            </button>
        </div>
    </div>

    <script>
        // GANTI INI DENGAN URL WEB APP GOOGLE SCRIPT ANDA SETELAH DEPLOY
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz4tBKTd-jliiVH3aiAazxcoi5-_9M8pZb8TPXKny-Z8UVnuUnRi-eUs8OpjuqFMPu2/exec";

        let currentMode = 'borrow';

        const dateOptions = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
        document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('id-ID', dateOptions).toUpperCase();

        function openForm(mode) {
            currentMode = mode;
            const landing = document.getElementById('landingPage');
            const form = document.getElementById('formPage');
            const header = document.getElementById('formHeader');
            const btn = document.getElementById('submitBtn');
            const title = document.getElementById('formTitle');
            const type = document.getElementById('entryType');

            if (mode === 'borrow') {
                header.className = "p-10 bg-gradient-to-r from-blue-700 via-blue-800 to-indigo-900 text-white flex items-center justify-between relative overflow-hidden";
                btn.className = "w-full bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-black py-6 rounded-[2.2rem] shadow-2xl shadow-blue-500/40 transition-all active:scale-95 flex items-center justify-center gap-4 mt-8 text-xl tracking-widest";
                title.textContent = "Peminjaman Koleksi";
                type.value = "Peminjaman";
            } else {
                header.className = "p-10 bg-gradient-to-r from-emerald-600 via-teal-700 to-cyan-800 text-white flex items-center justify-between relative overflow-hidden";
                btn.className = "w-full bg-gradient-to-r from-emerald-600 to-teal-700 text-white font-black py-6 rounded-[2.2rem] shadow-2xl shadow-emerald-500/40 transition-all active:scale-95 flex items-center justify-center gap-4 mt-8 text-xl tracking-widest";
                title.textContent = "Pengembalian Koleksi";
                type.value = "Pengembalian";
            }

            landing.style.opacity = '0';
            landing.style.transform = 'scale(0.95) translateY(-20px)';
            setTimeout(() => {
                landing.classList.add('hidden');
                form.classList.remove('hidden');
                form.style.opacity = '1';
                form.style.transform = 'translateY(0)';
            }, 400);
        }

        function backToLanding() {
            const landing = document.getElementById('landingPage');
            const form = document.getElementById('formPage');
            form.style.opacity = '0';
            form.style.transform = 'translateY(40px)';
            setTimeout(() => {
                form.classList.add('hidden');
                form.style.opacity = '1';
                form.style.transform = 'translateY(0)';
                landing.classList.remove('hidden');
                landing.style.opacity = '1';
                landing.style.transform = 'scale(1) translateY(0)';
            }, 400);
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            if (SCRIPT_URL.includes("MASUKKAN_URL")) {
                alert("Mohon masukkan URL Deployment Apps Script Anda di kode HTML.");
                return;
            }

            document.getElementById('loading').classList.remove('hidden');

            const payload = {
                entryType: document.getElementById('entryType').value,
                studentName: document.getElementById('studentName').value,
                studentClass: document.getElementById('studentClass').value,
                bookTitle: document.getElementById('bookTitle').value
            };

            try {
                // Pengiriman via Fetch dengan mode no-cors sesuai logika sebelumnya
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                // Beri sedikit jeda simulasi proses sebelum menampilkan modal sukses
                setTimeout(() => {
                    showSuccess(payload);
                }, 1000);

            } catch (err) {
                document.getElementById('loading').classList.add('hidden');
                alert("Terjadi kesalahan pengiriman data: " + err);
            }
        }

        function showSuccess(payload) {
            document.getElementById('loading').classList.add('hidden');
            const icon = document.getElementById('successIcon');
            const accent = document.getElementById('modalAccent');
            let msg = "";

            if (currentMode === 'borrow') {
                icon.className = "w-32 h-32 bg-blue-50 text-blue-600 rounded-[3.2rem] flex items-center justify-center mx-auto mb-10 text-7xl shadow-xl shadow-blue-100";
                accent.className = "absolute top-0 left-0 w-full h-5 bg-blue-600";
                msg = `Halo <span class='text-slate-900 font-black'>${payload.studentName}</span>, peminjamanmu berhasil dicatat. Silakan kembalikan buku sebelum <span class='text-blue-600 font-black'>10 HARI KERJA</span>.`;
            } else {
                icon.className = "w-32 h-32 bg-emerald-50 text-emerald-600 rounded-[3.2rem] flex items-center justify-center mx-auto mb-10 text-7xl shadow-xl shadow-emerald-100";
                accent.className = "absolute top-0 left-0 w-full h-5 bg-emerald-600";
                msg = `Terima kasih <span class='text-slate-900 font-black'>${payload.studentName}</span>!<br>Pengembalian buku telah diverifikasi.`;
            }

            document.getElementById('modalMsg').innerHTML = msg;
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('libraryForm').reset();
        }

        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
            backToLanding();
        }
    </script>
</body>
</html>
